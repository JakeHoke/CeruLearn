<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fetch API Client</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
</head>
<body>
        
    <input type="file" id="fileInput" accept=".mp4">
    <button onclick="uploadVideo()">Upload and Convert to Blob</button>
    
    <video controls width="400" id="videoPlayer"></video>
    
    <script>
        async function uploadAndStreamVideo() {
            const fileInput = document.getElementById('fileInput');
            const videoFile = fileInput.files[0];
            
            const formData = new FormData();
            formData.append('file', videoFile);
            
            const response = await fetch('http://127.0.0.1:5000/upload', {
                method: 'POST',
                body: formData
            });
    
            if (response.ok) {
                const videoPlayer = document.getElementById('videoPlayer');
                videoPlayer.src = response.url;
            }
        }
    </script>
        
    <script>
        const SECRET_KEY = "16_byte_secrt_ky";
    
        function encryptAES(plainText, key) {
            const iv = CryptoJS.lib.WordArray.random(128 / 8);
            const encrypted = CryptoJS.AES.encrypt(plainText, CryptoJS.enc.Utf8.parse(key), { iv: iv });
            const combinedData = iv.toString(CryptoJS.enc.Base64) + ":" + encrypted.toString();
    
            return combinedData;
        }
    
        async function sendData() {
            const dataStr = "JakeHoke/video1";
    
            // Encrypt the data using AES and CryptoJS
            const encryptedData = encryptAES(dataStr, SECRET_KEY);
    
            // Send encrypted blob to the server
            try {
                const response = await fetch('https://cerubase.cerulearnadmin.repl.co/data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: encryptedData
                });
    
                if (!response.ok) {
                    console.error('Server responded with an error status:', response.status);
                }
    
                const result = await response.json();
                console.log('Server response:', result);
            } catch (error) {
                console.error('Error occurred while sending/receiving data:', error);
            }
        }
    
        // Send data when the page loads
        //window.onload = () => {
        //   sendData();
        //};
    </script>
</body>
</html>
