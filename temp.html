<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fetch API Client</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
</head>
<body>
        
    
    <button onclick="streamVideo()">Stream Video as Blob</button>
    
    <video controls width="400" id="videoPlayer"></video>

    <script>
        async function streamVideo() {
            const response = await fetch('https://cerubase.cerulearnadmin.repl.co/stream');
            const videoData = await response.arrayBuffer();
    
            const blob = new Blob([videoData], { type: 'video/mp4' });
            const url = URL.createObjectURL(blob);
    
            const videoPlayer = document.getElementById('videoPlayer');
            videoPlayer.src = url;
        }
    </script>
        
    <script>
        const SECRET_KEY = "16_byte_secrt_ky";
    
        function encryptAES(plainText, key) {
            const iv = CryptoJS.lib.WordArray.random(128 / 8);
            const encrypted = CryptoJS.AES.encrypt(plainText, CryptoJS.enc.Utf8.parse(key), { iv: iv });
            const combinedData = iv.toString(CryptoJS.enc.Base64) + ":" + encrypted.toString();
    
            return combinedData;
        }
    
        async function sendData() {
            const dataStr = "JakeHoke/video1";
    
            // Encrypt the data using AES and CryptoJS
            const encryptedData = encryptAES(dataStr, SECRET_KEY);
    
            // Send encrypted blob to the server
            try {
                const response = await fetch('https://cerubase.cerulearnadmin.repl.co/data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: encryptedData
                });
    
                if (!response.ok) {
                    console.error('Server responded with an error status:', response.status);
                }
    
                const result = await response.json();
                console.log('Server response:', result);
            } catch (error) {
                console.error('Error occurred while sending/receiving data:', error);
            }
        }
    
        // Send data when the page loads
        //window.onload = () => {
        //   sendData();
        //};
    </script>
</body>
</html>
